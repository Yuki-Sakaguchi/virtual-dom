(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var view_1 = require("./flamework/view");
var app_1 = require("./flamework/app");
var state = {
    count: 0
};
var actions = {
    increment: function (state) {
        state.count++;
    }
};
var view = function (state, actions) {
    return view_1.h('div', null, view_1.h('p', null, state.count), view_1.h('button', { type: 'button', onclick: function () { return actions.increment(state); } }, 'count up'));
};
new app_1.App({
    el: '#app',
    state: state,
    view: view,
    actions: actions
});

},{"./flamework/app":2,"./flamework/view":3}],2:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var view_1 = require("./view");
var App = (function () {
    function App(params) {
        this.el = typeof params.el === "string" ? document.querySelector(params.el) : params.el;
        this.view = params.view;
        this.state = params.state;
        this.actions = this.dispatchAction(params.actions);
        this.resolveNode();
    }
    App.prototype.dispatchAction = function (actions) {
        var _this = this;
        var dispatched = {};
        var _loop_1 = function (key) {
            var action = actions[key];
            dispatched[key] = function (state) {
                var data = [];
                for (var _i = 1; _i < arguments.length; _i++) {
                    data[_i - 1] = arguments[_i];
                }
                var ret = action.apply(void 0, [state].concat(data));
                _this.resolveNode();
                return ret;
            };
        };
        for (var key in actions) {
            _loop_1(key);
        }
        return dispatched;
    };
    App.prototype.resolveNode = function () {
        this.newNode = this.view(this.state, this.actions);
        this.scheduleRender();
    };
    App.prototype.scheduleRender = function () {
        if (!this.skipRender) {
            this.skipRender = true;
            setTimeout(this.render.bind(this));
        }
    };
    App.prototype.render = function () {
        if (this.oldNode) {
            view_1.updateElement(this.el, this.oldNode, this.newNode);
        }
        else {
            this.el.appendChild(view_1.createElement(this.newNode));
        }
        this.oldNode = this.newNode;
        this.skipRender = false;
    };
    return App;
}());
exports.App = App;

},{"./view":3}],3:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
function h(nodeName, attributes) {
    var children = [];
    for (var _i = 2; _i < arguments.length; _i++) {
        children[_i - 2] = arguments[_i];
    }
    return {
        nodeName: nodeName,
        attributes: attributes,
        children: children
    };
}
exports.h = h;
function createElement(node) {
    if (!isVNode(node)) {
        return document.createTextNode(node.toString());
    }
    var el = document.createElement(node.nodeName);
    setAttributes(el, node.attributes);
    node.children.forEach(function (child) { return el.appendChild(createElement(child)); });
    return el;
}
exports.createElement = createElement;
function isVNode(node) {
    return typeof node !== "string" && typeof node !== "number";
}
function setAttributes(target, attrs) {
    for (var attr in attrs) {
        if (isEventAttr(attr)) {
            var eventName = attr.slice(2);
            target.addEventListener(eventName, attrs[attr]);
        }
        else {
            target.setAttribute(attr, attrs[attr]);
        }
    }
}
function isEventAttr(attr) {
    return /^on/.test(attr);
}
var ChangedType;
(function (ChangedType) {
    ChangedType[ChangedType["None"] = 0] = "None";
    ChangedType[ChangedType["Type"] = 1] = "Type";
    ChangedType[ChangedType["Text"] = 2] = "Text";
    ChangedType[ChangedType["Node"] = 3] = "Node";
    ChangedType[ChangedType["Value"] = 4] = "Value";
    ChangedType[ChangedType["Attr"] = 5] = "Attr";
})(ChangedType || (ChangedType = {}));
function hasChanged(a, b) {
    if (typeof a !== typeof b) {
        return ChangedType.Type;
    }
    if (!isVNode(a) && a !== b) {
        return ChangedType.Text;
    }
    if (isVNode(a) && isVNode(b)) {
        if (a.nodeName !== b.nodeName) {
            return ChangedType.Node;
        }
        if ((a.attributes !== null && b.attributes !== null) && a.attributes.value !== b.attributes.value) {
            return ChangedType.Value;
        }
        if (JSON.stringify(a.attributes) !== JSON.stringify(b.attributes)) {
            return ChangedType.Attr;
        }
    }
    return ChangedType.None;
}
function updateElement(parent, oldNode, newNode, index) {
    if (index === void 0) { index = 0; }
    if (oldNode == null) {
        parent.appendChild(createElement(newNode));
        return;
    }
    var target = parent.childNodes[index];
    if (newNode == null) {
        parent.removeChild(target);
        return;
    }
    var changeType = hasChanged(oldNode, newNode);
    switch (changeType) {
        case ChangedType.Type:
        case ChangedType.Text:
        case ChangedType.Node:
            parent.replaceChild(createElement(newNode), target);
            return;
        case ChangedType.Value:
            updateValue(target, newNode.attributes.value);
            return;
        case ChangedType.Attr:
            updateAttributes(target, oldNode.attributes, newNode.attributes);
            return;
    }
    if (isVNode(oldNode) && isVNode(newNode)) {
        for (var i = 0; i < newNode.children.length || i < oldNode.children.length; i++) {
            updateElement(target, oldNode.children[i], newNode.children[i], i);
        }
    }
}
exports.updateElement = updateElement;
function updateValue(target, newValue) {
    target.value = newValue;
}
function updateAttributes(target, oldAttributes, newAttributes) {
    for (var attr in oldAttributes) {
        if (!isEventAttr(attr)) {
            target.removeAttribute(attr);
        }
    }
    for (var attr in newAttributes) {
        if (!isEventAttr(attr)) {
            target.setAttribute(attr, newAttributes[attr]);
        }
    }
}

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvdHMvY291bnRlci50cyIsInNyYy90cy9mbGFtZXdvcmsvYXBwLnRzIiwic3JjL3RzL2ZsYW1ld29yay92aWV3LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7QUNBQSx5Q0FBMkM7QUFFM0MsdUNBQXNDO0FBUXRDLElBQU0sS0FBSyxHQUFHO0lBQ1osS0FBSyxFQUFFLENBQUM7Q0FDVCxDQUFDO0FBRUYsSUFBTSxPQUFPLEdBQXNCO0lBQ2pDLFNBQVMsRUFBRSxVQUFDLEtBQVk7UUFDdEIsS0FBSyxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQ2hCLENBQUM7Q0FDRixDQUFDO0FBRUYsSUFBTSxJQUFJLEdBQXlCLFVBQUMsS0FBSyxFQUFFLE9BQU87SUFDaEQsT0FBTyxRQUFDLENBQUMsS0FBSyxFQUFFLElBQUksRUFDWCxRQUFDLENBQUMsR0FBRyxFQUFFLElBQUksRUFBRSxLQUFLLENBQUMsS0FBSyxDQUFDLEVBQ3pCLFFBQUMsQ0FBQyxRQUFRLEVBQUUsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxjQUFNLE9BQUEsT0FBTyxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsRUFBeEIsQ0FBd0IsRUFBRSxFQUFFLFVBQVUsQ0FBQyxDQUNyRixDQUFDO0FBQ1gsQ0FBQyxDQUFDO0FBRUYsSUFBSSxTQUFHLENBQWlCO0lBQ3RCLEVBQUUsRUFBRSxNQUFNO0lBQ1YsS0FBSyxPQUFBO0lBQ0wsSUFBSSxNQUFBO0lBQ0osT0FBTyxTQUFBO0NBQ1IsQ0FBQyxDQUFDOzs7OztBQzNCSCwrQkFBbUU7QUFlbkU7SUFjRSxhQUFZLE1BQXNDO1FBQ2hELElBQUksQ0FBQyxFQUFFLEdBQUcsT0FBTyxNQUFNLENBQUMsRUFBRSxLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFD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LE1BQU0sQ0FBQyxLQUFLLEdBQUcsUUFBUSxDQUFDO0FBQzFCLENBQUM7QUFTRCxTQUFTLGdCQUFnQixDQUFDLE1BQW1CLEVBQUUsYUFBeUIsRUFBRSxhQUF5QjtJQUVqRyxLQUFLLElBQUksSUFBSSxJQUFJLGFBQWEsRUFBRTtRQUM5QixJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQ3RCLE1BQU0sQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDOUI7S0FDRjtJQUVELEtBQUssSUFBSSxJQUFJLElBQUksYUFBYSxFQUFFO1FBQzlCLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDdEIsTUFBTSxDQUFDLFlBQVksQ0FBQyxJQUFJLEVBQUUsYUFBYSxDQUFDLElBQUksQ0FBVyxDQUFDLENBQUM7U0FDMUQ7S0FDRjtBQUNILENBQUMiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCJpbXBvcnQgeyBWaWV3LCBoIH0gZnJvbSAnLi9mbGFtZXdvcmsvdmlldyc7XG5pbXBvcnQgeyBBY3Rpb25UcmVlIH0gZnJvbSAnLi9mbGFtZXdvcmsvYWN0aW9uJztcbmltcG9ydCB7IEFwcCB9IGZyb20gJy4vZmxhbWV3b3JrL2FwcCc7XG5cbnR5cGUgU3RhdGUgPSB0eXBlb2Ygc3RhdGU7XG50eXBlIEFjdGlvbnMgPSB0eXBlb2YgYWN0aW9ucztcblxuLyoqXG4gKiDjg5Xjg6zjg7zjg6Djg6/jg7zjgq/jgpLlhYPjgavjgqLjg5fjg6rjgrHjg7zjgrfjg6fjg7PjgpLkvZzmiJDjgZnjgotcbiAqL1xuY29uc3Qgc3RhdGUgPSB7XG4gIGNvdW50OiAwXG59O1xuXG5jb25zdCBhY3Rpb25zOiBBY3Rpb25UcmVlPFN0YXRlPiA9IHtcbiAgaW5jcmVtZW50OiAoc3RhdGU6IFN0YXRlKSA9PiB7XG4gICAgc3RhdGUuY291bnQrKztcbiAgfVxufTtcblxuY29uc3QgdmlldzogVmlldzxTdGF0ZSwgQWN0aW9ucz4gPSAoc3RhdGUsIGFjdGlvbnMpID0+IHtcbiAgcmV0dXJuIGgoJ2RpdicsIG51bGwsIFxuICAgICAgICAgICBoKCdwJywgbnVsbCwgc3RhdGUuY291bnQpLFxuICAgICAgICAgICBoKCdidXR0b24nLCB7IHR5cGU6ICdidXR0b24nLCBvbmNsaWNrOiAoKSA9PiBhY3Rpb25zLmluY3JlbWVudChzdGF0ZSkgfSwgJ2NvdW50IHVwJylcbiAgICAgICAgICk7XG59O1xuXG5uZXcgQXBwPFN0YXRlLCBBY3Rpb25zPih7XG4gIGVsOiAnI2FwcCcsXG4gIHN0YXRlLFxuICB2aWV3LFxuICBhY3Rpb25zXG59KTsiLCIvKipcbiAqIEFQUFxuICogICAgQWN0aW9u44GnU3RvcmXjgYzmm7TmlrDjgZXjgozjgZ/jgolWaWV344Gu5pu05paw5Yem55CG44KS5a6f6KGM44GZ44KLQ29udHJvbGxlcumDqFxuICovXG5pbXBvcnQgeyBBY3Rpb25UcmVlIH0gZnJvbSAnLi9hY3Rpb24nO1xuaW1wb3J0IHsgVmlldywgVk5vZGUsIGNyZWF0ZUVsZW1lbnQsIHVwZGF0ZUVsZW1lbnQgfSBmcm9tICcuL3ZpZXcnO1xuXG4vKipcbiAqIEFwcOOBruOCpOODs+OCv+ODvOODleOCp+ODvOOCuVxuICovXG5pbnRlcmZhY2UgQXBwQ29uc3RydWN0b3I8U3RhdGUsIEFjdGlvbnM+IHtcbiAgZWw6IEhUTUxFbGVtZW50IHwgc3RyaW5nOyAvLyDopqrjg47jg7zjg4lcbiAgdmlldzogVmlldzxTdGF0ZSwgQWN0aW9uVHJlZTxTdGF0ZT4+OyAvLyBWaWV344Gu5a6a576pXG4gIHN0YXRlOiBTdGF0ZTsgLy8g54q25oWL566h55CGXG4gIGFjdGlvbnM6IEFjdGlvblRyZWU8U3RhdGU+OyAvLyBBY3Rpb27jga7lrprnvqlcbn1cblxuLyoqXG4gKiBBcHDjgq/jg6njgrlcbiAqL1xuZXhwb3J0IGNsYXNzIEFwcDxTdGF0ZSwgQWN0aW9ucz4ge1xuICBwcml2YXRlIHJlYWRvbmx5IGVsOiBIVE1MRWxlbWVudDtcbiAgcHJpdmF0ZSByZWFkb25seSB2aWV3OiBWaWV3PFN0YXRlLCBBY3Rpb25UcmVlPFN0YXRlPj47XG4gIHByaXZhdGUgcmVhZG9ubHkgc3RhdGU6IFN0YXRlO1xuICBwcml2YXRlIHJlYWRvbmx5IGFjdGlvbnM6IEFjdGlvblRyZWU8U3RhdGU+O1xuICBwcml2YXRlIG9sZE5vZGU6IFZOb2RlO1xuICBwcml2YXRlIG5ld05vZGU6IFZOb2RlO1xuICBwcml2YXRlIHNraXBSZW5kZXI6IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIOOCs+ODs+OCueODiOODqeOCr+OCv1xuICAgKiBAcGFyYW0ge0FwcENvbnN0cnVjdG9yPFN0YXRlLCBBY3Rpb25zPn0gcGFyYW1zIFxuICAgKiBAY29uc3RydWN0b3JcbiAgICovXG4gIGNvbnN0cnVjdG9yKHBhcmFtczogQXBwQ29uc3RydWN0b3I8U3RhdGUsIEFjdGlvbnM+KSB7XG4gICAgdGhpcy5lbCA9IHR5cGVvZiBwYXJhbXMuZWwgPT09IFwic3RyaW5nXCIgPyBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHBhcmFtcy5lbCkgOiBwYXJhbXMuZWw7XG4gICAgdGhpcy52aWV3ID0gcGFyYW1zLnZpZXc7XG4gICAgdGhpcy5zdGF0ZSA9IHBhcmFtcy5zdGF0ZTtcbiAgICB0aGlzLmFjdGlvbnMgPSB0aGlzLmRpc3BhdGNoQWN0aW9uKHBhcmFtcy5hY3Rpb25zKTtcbiAgICB0aGlzLnJlc29sdmVOb2RlKCk7XG4gIH1cblxuICAvKipcbiAgICogQWN0aW9u44GrU3RhdGXjgpLmuKHjgZfjgIHmlrDjgZfjgYTku67mg7NET03jgpLkvZzjgotcbiAgICogQHBhcmFtIHtBY3Rpb25UcmVlPFN0YXRlPn0gYWN0aW9ucyBcbiAgICovXG4gIHByaXZhdGUgZGlzcGF0Y2hBY3Rpb24oYWN0aW9uczogQWN0aW9uVHJlZTxTdGF0ZT4pIHtcbiAgICBjb25zdCBkaXNwYXRjaGVkID0ge30gYXMgQWN0aW9uVHJlZTxTdGF0ZT47XG4gICAgZm9yIChsZXQga2V5IGluIGFjdGlvbnMpIHtcbiAgICAgIGNvbnN0IGFjdGlvbiA9IGFjdGlvbnNba2V5XTtcbiAgICAgIGRpc3BhdGNoZWRba2V5XSA9IChzdGF0ZTogU3RhdGUsIC4uLmRhdGE6IGFueSkgPT4ge1xuICAgICAgICBjb25zdCByZXQgPSBhY3Rpb24oc3RhdGUsIC4uLmRhdGEpO1xuICAgICAgICB0aGlzLnJlc29sdmVOb2RlKCk7XG4gICAgICAgIHJldHVybiByZXQ7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBkaXNwYXRjaGVkO1xuICB9XG5cbiAgLyoqXG4gICAqIOS7ruaDs0RPTeOCkuWGjeani+evieOBmeOCi1xuICAgKi9cbiAgcHJpdmF0ZSByZXNvbHZlTm9kZSgpOiB2b2lkICB7XG4gICAgdGhpcy5uZXdOb2RlID0gdGhpcy52aWV3KHRoaXMuc3RhdGUsIHRoaXMuYWN0aW9ucyk7XG4gICAgdGhpcy5zY2hlZHVsZVJlbmRlcigpO1xuICB9XG5cbiAgLyoqXG4gICAqIOODrOODs+ODgOODquODs+OCsOOBruOCueOCseOCuOODpeODvOODquODs+OCsFxuICAgKiDvvIjpgKPntprjgadBY3Rpb27jgYzlrp/ooYzjgZXjgozjgZ/mmYLjgavkvZXluqbjgoJET03jg4Tjg6rjg7zjgpLmm7jjgY3mj5vjgYjjgarjgYTjgZ/jgoHvvIlcbiAgICovXG4gIHByaXZhdGUgc2NoZWR1bGVSZW5kZXIoKTogdm9pZCAge1xuICAgIGlmICghdGhpcy5za2lwUmVuZGVyKSB7XG4gICAgICB0aGlzLnNraXBSZW5kZXIgPSB0cnVlO1xuICAgICAgc2V0VGltZW91dCh0aGlzLnJlbmRlci5iaW5kKHRoaXMpKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog5o+P55S7XG4gICAqL1xuICBwcml2YXRlIHJlbmRlcigpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5vbGROb2RlKSB7XG4gICAgICB1cGRhdGVFbGVtZW50KHRoaXMuZWwsIHRoaXMub2xkTm9kZSwgdGhpcy5uZXdOb2RlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5lbC5hcHBlbmRDaGlsZChjcmVhdGVFbGVtZW50KHRoaXMubmV3Tm9kZSkpO1xuICAgIH1cbiAgICB0aGlzLm9sZE5vZGUgPSB0aGlzLm5ld05vZGU7XG4gICAgdGhpcy5za2lwUmVuZGVyID0gZmFsc2U7XG4gIH1cbn0iLCIvKipcbiAqIFZpZXdcbiAqICAgIOS7ruaDs0RPTeOCkuS9nOaIkOOBmeOCi2jplqLmlbDjgpLlrprnvqlcbiAqL1xuXG50eXBlIE5vZGVUeXBlID0gVk5vZGUgfCBzdHJpbmcgfCBudW1iZXI7XG50eXBlIEF0dHJpYnV0ZXMgPSB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB8IEZ1bmN0aW9uIH07XG5cbmV4cG9ydCBpbnRlcmZhY2UgVmlldzxTdGF0ZSwgQWN0aW9ucz4ge1xuICAoc3RhdGU6IFN0YXRlLCBhY3Rpb25zOiBBY3Rpb25zKTogVk5vZGU7XG59XG5cbi8qKlxuICog5Luu5oOzRE9N44Kk44Oz44K/44O844OV44Kn44O844K5XG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgVk5vZGUge1xuICBub2RlTmFtZToga2V5b2YgRWxlbWVudFRhZ05hbWVNYXA7XG4gIGF0dHJpYnV0ZXM6IEF0dHJpYnV0ZXM7XG4gIGNoaWxkcmVuOiBOb2RlVHlwZVtdO1xufVxuXG4vKipcbiAqIOS7ruaDs0RPTeOCkuS9nOaIkOOBmeOCi+mWouaVsFxuICogQHBhcmFtIHtFbGVtZW50VGFnTmFtZU1hcH0gbm9kZU5hbWUg44K/44Kw5ZCNXG4gKiBAcGFyYW0ge0F0dHJpYnV0ZXN9IGF0dHJpYnV0ZXMg5bGe5oCn44Kq44OW44K444Kn44Kv44OIXG4gKiBAcGFyYW0ge0FycmF5PE5vZGVUeXBlPn0gY2hpbGRyZW4g5a2Q6KaB57SgXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBoKG5vZGVOYW1lOiBrZXlvZiBFbGVtZW50VGFnTmFtZU1hcCwgYXR0cmlidXRlczogQXR0cmlidXRlcywgLi4uY2hpbGRyZW46IE5vZGVUeXBlW10pOiBWTm9kZSB7XG4gIHJldHVybiB7XG4gICAgbm9kZU5hbWUsXG4gICAgYXR0cmlidXRlcyxcbiAgICBjaGlsZHJlblxuICB9O1xufVxuXG4vKipcbiAqIOODquOCouODq0RPTeOCkueUn+aIkOOBmeOCi+mWouaVsFxuICogQHBhcmFtIHtOb2RlVHlwZX0gbm9kZVxuICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRWxlbWVudChub2RlOiBOb2RlVHlwZSk6IEhUTUxFbGVtZW50IHwgVGV4dCB7XG4gIGlmICghaXNWTm9kZShub2RlKSkge1xuICAgIHJldHVybiBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShub2RlLnRvU3RyaW5nKCkpO1xuICB9XG4gIGNvbnN0IGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChub2RlLm5vZGVOYW1lKTtcbiAgc2V0QXR0cmlidXRlcyhlbCwgbm9kZS5hdHRyaWJ1dGVzKTtcbiAgbm9kZS5jaGlsZHJlbi5mb3JFYWNoKGNoaWxkID0+IGVsLmFwcGVuZENoaWxkKGNyZWF0ZUVsZW1lbnQoY2hpbGQpKSk7XG4gIHJldHVybiBlbDtcbn1cblxuLyoqXG4gKiDku67mg7NET03jgYvjganjgYbjgYvjgpLnorroqo3jgZnjgovplqLmlbBcbiAqIEBwYXJhbSB7Tm9kZVR5cGV9IG5vZGUgXG4gKiBAcmV0dXJuIHtib29sZWFufSDlvJXmlbDjgYzku67mg7NET03jgaDjgaPjgZ/loLTlkIh0cnVlLCDjgZ3jgozku6XlpJbjga9mYWxzZVxuICovXG5mdW5jdGlvbiBpc1ZOb2RlKG5vZGU6IE5vZGVUeXBlKTogbm9kZSBpcyBWTm9kZSB7XG4gIHJldHVybiB0eXBlb2Ygbm9kZSAhPT0gXCJzdHJpbmdcIiAmJiB0eXBlb2Ygbm9kZSAhPT0gXCJudW1iZXJcIjtcbn1cblxuLyoqXG4gKiDlsZ7mgKfjgpLov73liqDjgZnjgovplqLmlbBcbiAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IHRhcmdldCDlsZ7mgKfjgpLov73liqDjgZnjgovopoHntKBcbiAqIEBwYXJhbSB7QXR0cmlidXRlc30gYXR0cnMg5bGe5oCn44Kq44OW44K444Kn44Kv44OIXG4gKi9cbmZ1bmN0aW9uIHNldEF0dHJpYnV0ZXModGFyZ2V0OiBIVE1MRWxlbWVudCwgYXR0cnM6IEF0dHJpYnV0ZXMpOiB2b2lkIHtcbiAgZm9yIChsZXQgYXR0ciBpbiBhdHRycykge1xuICAgIGlmIChpc0V2ZW50QXR0cihhdHRyKSkge1xuICAgICAgY29uc3QgZXZlbnROYW1lID0gYXR0ci5zbGljZSgyKTtcbiAgICAgIHRhcmdldC5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgYXR0cnNbYXR0cl0gYXMgRXZlbnRMaXN0ZW5lcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRhcmdldC5zZXRBdHRyaWJ1dGUoYXR0ciwgYXR0cnNbYXR0cl0gYXMgc3RyaW5nKTtcbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiDlvJXmlbDjgYzjgqTjg5njg7Pjg4jjgpLooajjgZnmloflrZfliJfjgYvjganjgYbjgYvliKTlrppcbiAqIEBwYXJhbSB7c3RyaW5nfSBhdHRyIOWxnuaAp+WQjVxuICogQHJldHVybiB7Ym9vbGVhbn0g5byV5pWw44GM44Kk44OZ44Oz44OI44Gu5pmCdHJ1ZSwg44Gd44KM5Lul5aSW44Gu5pmCZmFsc2VcbiAqL1xuZnVuY3Rpb24gaXNFdmVudEF0dHIoYXR0cjogc3RyaW5nKTogYm9vbGVhbiB7XG4gIHJldHVybiAvXm9uLy50ZXN0KGF0dHIpO1xufVxuXG4vKipcbiAqIOWkieabtOOBjOOBguOBo+OBn+WgtOWQiOOBruWHpueQhuOCv+OCpOODl1xuICovXG5lbnVtIENoYW5nZWRUeXBlIHtcbiAgTm9uZSwgLy8g5beu5YiG44Gq44GXXG4gIFR5cGUsIC8vIG5vZGXjga7lnovjgYzpgZXjgYZcbiAgVGV4dCwgLy8g44OG44Kt44K544OI44OO44O844OJ44GM6YGV44GGXG4gIE5vZGUsIC8vIOODjuODvOODieWQje+8iOOCv+OCsOWQje+8ieOBjOmBleOBhlxuICBWYWx1ZSwgLy8gaW5wdXTjga52YWx1ZeOBjOmBleOBhlxuICBBdHRyIC8vIOWxnuaAp+OBjOmBleOBhlxufVxuXG4vKipcbiAqIO+8kuOBpOOBruS7ruaDs0RPTeOBruW3ruWIhuOCkuaknOefpeOBmeOCi++8iOS7luOBruODleODrOODvOODoOODr+ODvOOCr+OBoOOBqOOBk+OBk+OBruWHpueQhuOBr+OCguOBo+OBqOikh+mbkeOBi+OCgu+8iVxuICogQHBhcmFtIHtOb2RlVHlwZX0gYmVmb3JlIOWkieabtOWJjVxuICogQHBhcmFtIHtOb2RlVHlwZX0gYWZ0ZXIg5aSJ5pu05b6MXG4gKi9cbmZ1bmN0aW9uIGhhc0NoYW5nZWQoYTogTm9kZVR5cGUsIGI6IE5vZGVUeXBlKTogQ2hhbmdlZFR5cGUge1xuICAvLyBkaWZmZXJlbnQgdHlwZVxuICBpZiAodHlwZW9mIGEgIT09IHR5cGVvZiBiKSB7XG4gICAgcmV0dXJuIENoYW5nZWRUeXBlLlR5cGU7XG4gIH1cblxuICAvLyBkaWZmZXJlbnQgc3RyaW5nXG4gIGlmICghaXNWTm9kZShhKSAmJiBhICE9PSBiKSB7XG4gICAgcmV0dXJuIENoYW5nZWRUeXBlLlRleHQ7XG4gIH1cblxuICAvLyDnsKHmmJPnmoTmr5TovIMoKVxuICBpZiAoaXNWTm9kZShhKSAmJiBpc1ZOb2RlKGIpKSB7XG4gICAgaWYgKGEubm9kZU5hbWUgIT09IGIubm9kZU5hbWUpIHtcbiAgICAgIHJldHVybiBDaGFuZ2VkVHlwZS5Ob2RlO1xuICAgIH1cbiAgICBpZiAoKGEuYXR0cmlidXRlcyAhPT0gbnVsbCAmJiBiLmF0dHJpYnV0ZXMgIT09IG51bGwpICYmIGEuYXR0cmlidXRlcy52YWx1ZSAhPT0gYi5hdHRyaWJ1dGVzLnZhbHVlKSB7XG4gICAgICByZXR1cm4gQ2hhbmdlZFR5cGUuVmFsdWU7XG4gICAgfVxuICAgIGlmIChKU09OLnN0cmluZ2lmeShhLmF0dHJpYnV0ZXMpICE9PSBKU09OLnN0cmluZ2lmeShiLmF0dHJpYnV0ZXMpKSB7XG4gICAgICByZXR1cm4gQ2hhbmdlZFR5cGUuQXR0cjtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIENoYW5nZWRUeXBlLk5vbmU7XG59XG5cbi8qKlxuICog5Luu5oOzRE9N44Gu5beu5YiG44KS5qSc55+l44GX44CB44Oq44Ki44OrRE9N44Gr5Y+N5pig44GZ44KLXG4gKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBwYXJlbnQgXG4gKiBAcGFyYW0ge05vZGVUeXBlfSBvbGROb2RlIFxuICogQHBhcmFtIHtOb2RlVHlwZX0gbmV3Tm9kZSBcbiAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZUVsZW1lbnQocGFyZW50OiBIVE1MRWxlbWVudCwgb2xkTm9kZTogTm9kZVR5cGUsIG5ld05vZGU6IE5vZGVUeXBlLCBpbmRleCA9IDApOiB2b2lkIHtcbiAgLy8g5Y+k44GETm9kZeOBjOOBquOBkeOCjOOBsOaWsOOBl+OBj+S9nOOCi1xuICBpZiAob2xkTm9kZSA9PSBudWxsKSB7XG4gICAgcGFyZW50LmFwcGVuZENoaWxkKGNyZWF0ZUVsZW1lbnQobmV3Tm9kZSkpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IHRhcmdldCA9IHBhcmVudC5jaGlsZE5vZGVzW2luZGV4XTtcblxuICAvLyDmlrDjgZfjgYROb2Rl44GM44Gq44GR44KM44Gw5YmK6ZmkXG4gIGlmIChuZXdOb2RlID09IG51bGwpIHtcbiAgICBwYXJlbnQucmVtb3ZlQ2hpbGQodGFyZ2V0KTtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyDjganjgaHjgonjgoLjgYLjgozjgbDlt67liIbjgpLjg4Hjgqfjg4Pjgq/jgZfjgIHlh6bnkIbjgpLooYzjgYZcbiAgY29uc3QgY2hhbmdlVHlwZSA9IGhhc0NoYW5nZWQob2xkTm9kZSwgbmV3Tm9kZSk7XG5cbiAgc3dpdGNoKGNoYW5nZVR5cGUpIHtcbiAgICBjYXNlIENoYW5nZWRUeXBlLlR5cGU6XG4gICAgY2FzZSBDaGFuZ2VkVHlwZS5UZXh0OlxuICAgIGNhc2UgQ2hhbmdlZFR5cGUuTm9kZTpcbiAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQoY3JlYXRlRWxlbWVudChuZXdOb2RlKSwgdGFyZ2V0KTtcbiAgICAgIHJldHVybjtcbiAgICBjYXNlIENoYW5nZWRUeXBlLlZhbHVlOlxuICAgICAgdXBkYXRlVmFsdWUodGFyZ2V0IGFzIEhUTUxJbnB1dEVsZW1lbnQsIChuZXdOb2RlIGFzIFZOb2RlKS5hdHRyaWJ1dGVzLnZhbHVlIGFzIHN0cmluZyk7XG4gICAgICByZXR1cm47XG4gICAgY2FzZSBDaGFuZ2VkVHlwZS5BdHRyOlxuICAgICAgdXBkYXRlQXR0cmlidXRlcyh0YXJnZXQgYXMgSFRNTEVsZW1lbnQsIChvbGROb2RlIGFzIFZOb2RlKS5hdHRyaWJ1dGVzLCAobmV3Tm9kZSBhcyBWTm9kZSkuYXR0cmlidXRlcyk7XG4gICAgICByZXR1cm47XG4gIH1cblxuICAvLyDlho3luLDnmoTjgavlrZDopoHntKDjga7mm7TmlrDjgpLooYzjgYZcbiAgaWYgKGlzVk5vZGUob2xkTm9kZSkgJiYgaXNWTm9kZShuZXdOb2RlKSkge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbmV3Tm9kZS5jaGlsZHJlbi5sZW5ndGggfHwgaSA8IG9sZE5vZGUuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcbiAgICAgIHVwZGF0ZUVsZW1lbnQodGFyZ2V0IGFzIEhUTUxFbGVtZW50LCBvbGROb2RlLmNoaWxkcmVuW2ldLCBuZXdOb2RlLmNoaWxkcmVuW2ldLCBpKTtcbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiB0YXJnZXTjga52YWx1ZeOCkuabtOaWsFxuICogQHBhcmFtIHtIVE1MSW5wdXRFbGVtZW50fSB0YXJnZXQgXG4gKiBAcGFyYW0ge3N0cmluZ30gbmV3VmFsdWUgXG4gKi9cbmZ1bmN0aW9uIHVwZGF0ZVZhbHVlKHRhcmdldDogSFRNTElucHV0RWxlbWVudCwgbmV3VmFsdWU6IHN0cmluZyk6IHZvaWQge1xuICB0YXJnZXQudmFsdWUgPSBuZXdWYWx1ZTtcbn1cblxuLyoqXG4gKiB0YXJnZXTjga7lsZ7mgKflgKTjgpLmm7TmlrBcbiAqIOWNmOe0lOOBq05vZGXjgZTjgahyZXBsYWNl44GX44Gm44GX44G+44GG44GoaW5wdXTjga7jg5Xjgqnjg7zjgqvjgrnjgYzlpJbjgozjgabjgZfjgb7jgYbjga7jgaflgKTjgaDjgZHmm7TmlrBcbiAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IHRhcmdldCBcbiAqIEBwYXJhbSB7QXR0cmlidXRlc30gb2xkQXR0cmlidXRlcyBcbiAqIEBwYXJhbSB7QXR0cmlidXRlc30gbmV3QXR0cmlidXRlcyBcbiAqL1xuZnVuY3Rpb24gdXBkYXRlQXR0cmlidXRlcyh0YXJnZXQ6IEhUTUxFbGVtZW50LCBvbGRBdHRyaWJ1dGVzOiBBdHRyaWJ1dGVzLCBuZXdBdHRyaWJ1dGVzOiBBdHRyaWJ1dGVzKTogdm9pZCB7XG4gIC8vIOWPpOOBhOOBruOBr+a2iOOBmVxuICBmb3IgKGxldCBhdHRyIGluIG9sZEF0dHJpYnV0ZXMpIHtcbiAgICBpZiAoIWlzRXZlbnRBdHRyKGF0dHIpKSB7XG4gICAgICB0YXJnZXQucmVtb3ZlQXR0cmlidXRlKGF0dHIpO1xuICAgIH1cbiAgfVxuICAvLyDmlrDjgZfjgYTjgoLjga7jgpLov73liqDjgZnjgotcbiAgZm9yIChsZXQgYXR0ciBpbiBuZXdBdHRyaWJ1dGVzKSB7XG4gICAgaWYgKCFpc0V2ZW50QXR0cihhdHRyKSkge1xuICAgICAgdGFyZ2V0LnNldEF0dHJpYnV0ZShhdHRyLCBuZXdBdHRyaWJ1dGVzW2F0dHJdIGFzIHN0cmluZyk7XG4gICAgfVxuICB9XG59ICJdfQ==
